window.nvpack=window.nvpack||{},window.nvpack.anal=function(){"use strict";function t(t,e,n,i,s,r,o){try{var a=t[r](o),c=a.value}catch(t){return void n(t)}a.done?e(c):Promise.resolve(c).then(i,s)}function e(e){return function(){var n=this,i=arguments;return new Promise(function(s,r){var o=e.apply(n,i);function a(e){t(o,s,r,a,c,"next",e)}function c(e){t(o,s,r,a,c,"throw",e)}a(void 0)})}}class n{constructor(){this.document=window.document}set(t,e,n,i){var s=new Date((new Date).setHours(23,59,59,0));n=n||0==n?"expires="+n:"expires="+s,i=i?"domain=."+i:"",document.cookie=t+"="+e+"; "+n+"; "+i+"; path=/; secure"}get(t){for(var e=t+"=",n=document.cookie.split(";"),i=0;i<n.length;i++){var s=n[i].trim();if(0==s.indexOf(e))return s.substring(e.length,s.length)}return null}remove(t){document.cookie=t+"=; Max-Age=-99999999;"}lsSupport(){return!!window.localStorage}setLS(t,e){return this.lsSupport()&&localStorage.setItem(t,e)}getLS(t){return this.lsSupport()?localStorage.getItem(t):null}duration(t){var e=1,n="Fri, 31 Dec 1999 23:59:59 GMT";if(t)if(501==t)n="Fri, 31 Dec 1999 23:59:59 GMT";else if(0==t)n=0;else{500==t?e=365:t>0&&t<=90&&(e=t);var i=new Date;1!=e&&(e-=1,i.setTime(i.getTime()+24*e*60*60*1e3)),i.setHours(23,59,59,0),n=i}return n}}var i=()=>{var t,e,n=window.document,i=0;return{get:function(s,r,a,u){var v=-1!==s.indexOf("?")?"&":"?";r=r||{};var h=o(),d=c();for(e in h&&Array.isArray(h)&&h.length>0&&(r.cookieData=h.join(";")),d&&(r.storage=d),notify_visitors&&notify_visitors.cookie_domain&&(r.cookieDomain=notify_visitors.cookie_domain),r)r.hasOwnProperty(e)&&(v+=encodeURIComponent(e)+"="+encodeURIComponent(r[e])+"&");var l=a+ ++i;return window[l]=function(t){u(t);try{delete window[l]}catch(t){}window[l]=null},function(e){var i=n.createElement("script"),s=!1;i.src=e,i.async=!0,i.onload=i.onreadystatechange=function(){s||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(s=!0,i.onload=i.onreadystatechange=null,i&&i.parentNode&&i.parentNode.removeChild(i))},!t&&(t=n.getElementsByTagName("head")[0]),t.appendChild(i)}(s+v+"js_callback="+l),l},post:function(t,e,n,i,s){s.ajax({url:t,type:"POST",data:e,contentType:!1,processData:!1,success:i})}}},s=()=>{return{bind:function(t,e,n,i){return i&&""!=i&&(window.notify_visitors.eventsRecord=window.notify_visitors.eventsRecord||{},window.notify_visitors.eventsRecord[i]=window.notify_visitors.eventsRecord[i]||[],window.notify_visitors.eventsRecord[i].push({n:e,e:t,c:n})),t.addEventListener?t.addEventListener(e,n):t.attachEvent?t.attachEvent("on"+e,n):void 0},unbind:function(t,e,n){return t.removeEventListener?t.removeEventListener(e,n):t.detachEvent?t.detachEvent("on"+e,n):void 0}}},r=()=>{return function(){if("function"==typeof window.CustomEvent)return!1;function t(t,e){e=e||{bubbles:!1,cancelable:!1,detail:null};var n=document.createEvent("CustomEvent");return n.initCustomEvent(t,e.bubbles,e.cancelable,e.detail),n}t.prototype=window.Event.prototype,window.CustomEvent=t}(),{send:function(t,e){var n=new CustomEvent("notifyvisitors_callback",{detail:{data:t,url:document.location.href,type:e}});window.dispatchEvent(n)}}},o=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=[];if(document&&document.cookie){var n=document.cookie.split(";");"all"===t&&(e=n),Array.isArray(t)&&n&&n.length>0&&(e=n.filter(function(e){var n=e.trim().split("=")[0];return!!t.includes(n)||0===n.indexOf("_nv_")}))}return e},a=function(){var t=e(function*(t){var e="";if(t)if("function"==typeof ga&&ga.getAll&&Array.isArray(ga.getAll())&&ga.getAll().length>0){var n=ga.getAll();e=Array.isArray(n)&&n.length?n[0].get("clientId"):""}else if("function"==typeof gtag){var i=t.gaEvents&&t.gaEvents.trackingID?t.gaEvents.trackingID:null;if(!i){var s=Object.keys(window.google_tag_manager||[]).filter(t=>"G-"==t.substring(0,2));i=Array.isArray(s)&&s.length?s[0]:null}if(i){e=yield new Promise(t=>{gtag("get",i,"client_id",t)})}}return e});return function(e){return t.apply(this,arguments)}}(),c=()=>{var t={session:u("sessionStorage"),local:u("localStorage")};return JSON.stringify(t)},u=t=>{var e={};if(window[t]&&window[t].length>0&&Object.keys(window[t]).forEach(function(n){-1!==n.indexOf("_nv_")&&(e[n]=window[t][n])}),"sessionStorage"==t){var n=window.sessionStorage.getItem("_nv_location");e._nv_location||null===n||(e._nv_location=n);var i=window.sessionStorage.getItem("_nv_ath");e._nv_ath||null===i||(e._nv_ath=i)}return e},v=function(t){var e=JSON.stringify(t);e=h(e,3),e=(e=d(e)).split("").map(t=>t.charCodeAt(0).toString(16)).join("-");var n=l(e);return btoa(n)},h=function(t,e){return t.split("").map(t=>String.fromCharCode(t.charCodeAt(0)+e)).join("")},d=function(t){return t.split("").reverse().join("")},l=function(t){for(var e="",n=f(),i=w(),s=0;s<t.length;s++){var r=t[s],o=n.indexOf(r);e+=-1!==o?i[o]:r}return e},f=function(){var t,e="";for(t=0;t<=25;t++)e+=String.fromCharCode(t+65);for(t=0;t<=25;t++)e+=String.fromCharCode(t+97);for(t=0;t<10;t++)e+=t;return e+"+/="},w=function(){var t,e="";for(t=25;t>=0;t--)e+=String.fromCharCode(t+65);for(t=9;t>=0;t--)e+=t;for(t=0;t<=25;t++)e+=String.fromCharCode(t+97);return e+"+/="},p="https://analytics.notifyvisitors.com/",_={event:p+"brand/t1/event",user:p+"brand/t1/users",dimensions:p+"brand/t1/dimensions",userSessions:p+"brand/t1/userSessions",collectSessions:p+"brand/t1/collectSessions"},b=new Date;class m{constructor(t){this.response={},this.session=t.data&&t.data.session||"",this.set_NV_UID=t.data&&t.data.set_NV_UID||"",this.config=this.config||{},this.data=this.data||{},this.bindEvent=s(),this.callbackNotifyEvent=r(),this.getJSONP=i(),this.callbackName="nv_anal_json",this.productName="analytics",this.cookieController=new n,this.checkAuth(t.Events.data),this.nvHandler}checkAuth(t,e){this.response=t,null!=t.auth&&(null!=t.async&&!1!==t.async?handleWindowLoad():this.init())}setGaClientID(){var t=this;return e(function*(){t.nvGaClientID=yield a(t.response)})()}handleWindowLoad(){"complete"==document.readyState?this.init():this.bindEvent.bind(window,"load",init,this.productName)}init(){if(nvpack.config=nvpack.config||{},nvpack.config.a)return!1;nvpack.config.a=!0,nvpack.callbackNotifyEvent=this.callbackNotifyEvent,this.setGaClientID(),this.config.urls=_,this.data.auth=this.response.auth||{},this.data.setting=this.response.auth||{},this.data.auth.ruleData&&(this.data.setting.ruleData=this.data.auth.ruleData=this.response.ruleData),this.response.tokens&&(this.data.setting.tokens=this.data.auth.tokens=this.response.tokens),this.data.setting.trafficSource=this.data.auth.trafficSource=document.referrer,this.data.setting.isPwa=window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches?1:0,this.data.setting.pageUrl=this.data.auth.pageUrl=document.location,this.data.setting.gmOffset=this.data.auth.gmOffset=60*b.getTimezoneOffset()*-1,this.data.setting.screenWidth=this.data.auth.screenWidth=screen.width,this.data.setting.screenHeight=this.data.auth.screenHeight=screen.height,this.data.setting.storage=this.data.auth.storage=this.browserStorage(),this.data.setting.linkreferrer=this.data.auth.linkreferrer=document.referrer,this.callbackNotifyEvent.send("analytics_init","loadscript"),this.load()}load(){var t=this;if("fail"==this.response.Authentication)return!1;if(this.nvHandler=function(e){var n=Array.prototype.slice.call(e);t.performEventActions(n)},this.nvStaticEvent=function(){var e=t.response.event_integration;Object.keys(e).forEach(n=>{void 0!==e[n].event_initialize_type&&0!=e[n].event_initialize_type?this.callStaticEventonClick(e[n].event_initialize_type,e[n].event,e[n].attributes,e[n].ltv,e[n].scope):t.eventAction(e[n].event,e[n].attributes,e[n].ltv,e[n].scope,1)})},t.response.event_integration&&(this.nvStaticEvent(),this.processPendingStaticEvents()),t.response.event_user_tracking&&this.sendUserEventData(t.response.event_user_tracking),t.response.form_tracking)for(var e=0;e<t.response.form_tracking.length;e++){var n=t.response.form_tracking[e];this.form_tracking(n)}if(t.response.newSess&&t.response.defaultEvents&&t.response.defaultEvents.sessionStartTracking&&1==t.response.defaultEvents.sessionStartTracking&&t.eventAction("session_start",{},10,2),t.response.defaultEvents&&t.response.defaultEvents.pageViewTracking&&1==t.response.defaultEvents.pageViewTracking){var i={};t.response.utm_sess_change&&(i.utm_visit=!0),t.eventAction("page_view",i,10,1)}}form_tracking(t){if(t){var e=null;if(t.formData)try{e=JSON.parse(t.formData)}catch(t){}var n=null;if(t.eventData)try{n=JSON.parse(t.eventData)}catch(t){}if(e&&e.btn_fields&&e.btn_fields[0]&&e.btn_fields[0].fieldSelector){var i=document.querySelector(e.btn_fields[0].fieldSelector);if(i){var s={},r={},o=null;i.addEventListener("click",function(i){for(var a=0;a<e.input_fields.length;a++){var c=e.input_fields[a];if(c&&c.fieldSelector){var u=document.querySelector(c.fieldSelector)?document.querySelector(c.fieldSelector).value:"";if(c.required&&!u)return;c.userAttr&&("userID"==c.userAttr?o=1==t.user_merge?{userID:u}:u:s[c.userAttr]=u,(null==o||o&&!o.hasOwnProperty("userID"))&&1==t.user_merge&&["email","mobile","phone"].includes(c.userAttr)&&(o?o[c.userAttr]=u:(o={})[c.userAttr]=u)),c.userMap&&(o=1==t.user_merge?{userID:u}:u),c.eventAttr&&(r[c.eventAttr]=u)}}o&&(o="object"==typeof o?JSON.stringify(o):o,n&&n.eventName?(sessionStorage.setItem("_nv_form_userevent",btoa(JSON.stringify({userID:o,userMapping:s,eventName:n.eventName,eventMaping:r}))),nv("userevent",[o,s,n.eventName,r,10,1])):(sessionStorage.setItem("_nv_form_user",btoa(JSON.stringify({userID:o,userMapping:s}))),nv("user",o,s)))})}}}}sendUserEventData(t){var e=null;t&&t._nv_form_userevent&&(e=t._nv_form_userevent),t&&t._nv_form_user&&(e=t._nv_form_user),e&&e.userID&&e.userMapping&&e.eventName&&e.eventMaping?(nv("userevent",[e.userID,e.userMapping,e.eventName,e.eventMaping,10,1]),sessionStorage.removeItem("_nv_form_userevent")):e.userID&&e.userMapping&&(nv("user",e.userID,e.userMapping),sessionStorage.removeItem("_nv_form_user"))}callStaticEventonClick(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",r=this;if(e)var o=setInterval(function(){var a;if("X-Path"===t.type){if(!document.evaluate)return clearInterval(o),0;a=document.evaluate(t.value,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue}else a="css"===t.type?document.querySelector(t.value):document.querySelector("#"+t.value);null!==a&&(clearInterval(o),a.addEventListener("click",function(){t.click_redirect&&1==t.click_redirect?sessionStorage.setItem("_nv_static_event",btoa(JSON.stringify({event:e,attributes:n,ltv:i,scope:s,event_type:1}))):r.eventAction(e,n,i,s,1)}))},500)}performEventActions(t){if(!t[0])return!1;switch(t[0]){case"user":this.userAction(t[1],t[2]);break;case"userevent":if(!(t[1]&&Array.isArray(t[1])&&t[1].length>3))break;this.userEventAction(t[1][0],t[1][1],t[1][2],t[1][3],t[1][4]||"",t[1][5]||"");break;case"pushuser":this.cookieController.get("_nv_push_subscribe")&&this.userAction(t[1],t[2]);break;case"event":this.eventAction(t[1],t[2],t[3],t[4]);break;case"pushevent":this.pusheventAction(t[1],t[2],t[3],t[4])}}validateUserHit(t,e){var n=!1,i="";return("string"==typeof t&&t.trim()||"object"==typeof t&&null!==t&&Object.keys(t).length>0||"number"==typeof t)&&("string"==typeof t||"number"==typeof t?(n=!0,i=t):"object"==typeof t&&t&&(t.userID||t.email||t.mobile)&&(n=!0,i=t.userID||"","object"==typeof e&&e||(e={}),t.email&&(e.email=t.email),t.mobile&&(e.mobile=t.mobile))),{flag:n,userID:i}}userAction(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{flag:n,userID:i}=this.validateUserHit(t,e);if(n){var s=Object.assign({},this.data.setting);s.userID_en=v(i),this.nvGaClientID&&(e.nvGaClientID=this.nvGaClientID),e&&"object"==typeof e&&Object.keys(e).length&&(e.nvSegmentID||e.nvFormID||e.nvChannel)&&(e.nvSegmentID&&(s.segmentID=e.nvSegmentID,delete e.nvSegmentID),e.nvFormID&&(s.FormID=e.nvFormID,delete e.nvFormID),e.nvChannel&&(s.channel=e.nvChannel,delete e.nvChannel),e.nvEventAttribute&&(s.nv_event_attributes=e.nvEventAttribute,delete e.nvEventAttribute)),s.userParams_en=e?JSON.stringify(e):"",s.userParams_en=v(s.userParams_en),this.getJSONP.get(this.config.urls.user,s,this.callbackName,this.userActionResponse.bind(this))}}userActionResponse(t){if(t&&"object"==typeof t){if(t.campaignCookie&&this.session&&this.session(t.campaignCookie),t.nv_uid&&t.formID){var e=["nv_leadform_data",t.nv_uid,t.formID,t.brandid],n=window.location.href;parent.postMessage(JSON.stringify(e),n)}if("success"!=t.Authentication&&t.formID){var i=["nv_leadform_data_error","Something went wrong",t.formID];n=window.location.href;parent.postMessage(JSON.stringify(i),n)}t.nv_uid&&this.set_NV_UID&&this.set_NV_UID(t.nv_uid),"success"==t.Authentication&&sessionStorage.removeItem("_nv_form_user")}"object"==typeof t&&"success"==t.Authentication&&t.nv_uid&&(this.response.nv_uid!=t.nv_uid||t._nv_user_changed)&&(this.response.nv_uid=t.nv_uid,this.updateUserIdPushSubscribe(t)),t.callback_data&&this.callbackNotifyEvent.send(t.callback_data,"user")}updateUserIdPushSubscribe(t){window.notify_visitors.po&&window.notify_visitors.po.updateUserIdSubscription&&window.notify_visitors.po.updateUserIdSubscription()}userEventAction(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0,r=arguments.length>5?arguments[5]:void 0,{flag:o,userID:a}=this.validateUserHit(t,e);if(o&&n){var c=Object.assign({},this.data.setting);c.userID_en=v(a),this.nvGaClientID&&(e.nvGaClientID=this.nvGaClientID),e&&"object"==typeof e&&Object.keys(e).length&&(e.nvSegmentID||e.nvFormID||e.nvChannel)&&(e.nvSegmentID&&(c.segmentID=e.nvSegmentID,delete e.nvSegmentID),e.nvFormID&&(c.FormID=e.nvFormID,delete e.nvFormID),e.nvChannel&&(c.channel=e.nvChannel,delete e.nvChannel)),c.userParams_en=e?JSON.stringify(e):"",c.userParams_en=v(c.userParams_en),c.event_name=n,c.attributes=i?JSON.stringify(i):"",s&&(c.ltv=s),r&&(c.scope=r),this.getJSONP.get(this.config.urls.user,c,this.callbackName,this.userEventActionResponse.bind(this))}}userEventActionResponse(t){if(t&&"object"==typeof t&&Object.keys(t).length>0){var e=t.userResponse||"",n=t.eventResponse||"";e&&"object"==typeof e&&this.userActionResponse(e),n&&"object"==typeof n&&this.eventActionResponse(n)}}pusheventAction(t,e,n,i){this.cookieController.get("nv_push_subscribe")&&eventAction(t,e,n,i)}eventAction(t,e,n,i,s){if(t){var r=Object.assign({},this.data.setting);r.event_name=t,e&&(r.attributes=JSON.stringify(e)),n&&(r.ltv=n),i&&(r.scope=i),s&&(r.event_type=s),this.getJSONP.get(this.config.urls.event,r,this.callbackName,this.eventActionResponse.bind(this))}}eventActionResponse(t){t.campaignCookie&&this.session&&this.session(t.campaignCookie),t.callback_data&&this.callbackNotifyEvent.send(t.callback_data,"event"),"success"==t.Authentication&&sessionStorage.removeItem("_nv_form_userevent")}processPendingStaticEvents(){var t=sessionStorage.getItem("_nv_static_event");if(t&&""!==t){try{t=JSON.parse(atob(t))}catch(e){t={}}Object.keys(t).length>0&&(this.eventAction(t.event,t.attributes,t.ltv,t.scope,t.event_type),sessionStorage.removeItem("_nv_static_event"))}}browserStorage(){var t={session:this.storage("sessionStorage"),local:this.storage("localStorage")};return JSON.stringify(t)}storage(t){var e={};return window[t]&&window[t].length>0&&Object.keys(window[t]).forEach(function(n){-1!==n.indexOf("_nv_")&&(e[n]=window[t][n])}),e}}var g=new m(window.notify_visitors);return m.nvHandler=g.nvHandler,m}();
